<!DOCTYPE html>
<html>
<head>
    <title>QR Generator Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0; }
        input, button { padding: 10px; margin: 10px 0; font-size: 16px; }
        button { background: #007cba; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .result { margin: 20px 0; text-align: center; border: 2px solid #ccc; padding: 20px; }
    </style>
</head>
<body>
    <h1>ðŸ¤– RevBot QR Generator Test</h1>

    <div class="container">
        <h3>Generate QR Code - $0.05</h3>
        <input type="text" id="text" placeholder="Enter text (e.g., https://google.com)" style="width: 300px;">
        <br>
        <input type="number" id="size" value="300" min="100" max="500" style="width: 100px;">
        <br>
        <button onclick="generateQR()" style="font-size: 18px; padding: 15px 30px;">ðŸ”µ Generate QR Code ($0.05)</button>
    </div>

    <div id="result" class="result" style="display: none;">
        <h4>Your QR Code:</h4>
        <div id="qr-image"></div>
        <p id="qr-info"></p>
    </div>

    <script>
        async function generateQR() {
            console.log('Button clicked!'); // Debug

            const text = document.getElementById('text').value;
            const size = parseInt(document.getElementById('size').value) || 300;

            if (!text.trim()) {
                alert('Please enter some text to encode');
                return;
            }

            console.log('Making request with:', { text, size }); // Debug

            try {
                const response = await fetch('http://localhost:4001/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        size: size,
                        format: 'png'
                    })
                });

                console.log('Response status:', response.status); // Debug

                const result = await response.json();
                console.log('Response data:', result); // Debug

                if (result.success) {
                    document.getElementById('qr-image').innerHTML =
                        `<img src="data:image/png;base64,${result.qr_code}" alt="Generated QR Code" style="max-width: 400px;">`;
                    document.getElementById('qr-info').innerHTML =
                        `<strong>Cost: $${(result.cost / 100).toFixed(2)}</strong><br>
                         Generation ID: ${result.generation_id}<br>
                         Size: ${result.size}x${result.size} pixels`;
                    document.getElementById('result').style.display = 'block';
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Network error:', error); // Debug
                alert('Network error: ' + error.message);
            }
        }
    </script>
</body>
</html>